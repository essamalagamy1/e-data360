# نظام الإشعارات والبريد الإلكتروني

## نظرة عامة

تم إنشاء نظام إشعارات كامل يرسل إشعارات في الداشبورد وبريد إلكتروني عند استلام:

-   رسائل من نموذج الاتصال
-   طلبات تصميم
-   تقييمات من العملاء
-   طلبات توظيف

## المكونات

### 1. Notification Classes

-   `NewContactMessage` - رسائل الاتصال
-   `NewDesignRequest` - طلبات التصميم
-   `NewTestimonial` - التقييمات
-   `NewJobApplication` - طلبات التوظيف

### 2. جدول الإشعارات

تم إنشاء جدول `notifications` لتخزين الإشعارات في قاعدة البيانات.

### 3. جرس الإشعارات في Filament

تم تفعيل جرس الإشعارات في الداشبورد مع:

-   تحديث تلقائي كل 30 ثانية
-   عرض الإشعارات غير المقروءة
-   إمكانية وضع علامة "مقروء"

## كيفية العمل

### عند استلام رسالة/طلب جديد:

1. **حفظ البيانات** في قاعدة البيانات
2. **إرسال إشعار** لجميع المسؤولين (is_admin = true)
3. **إرسال بريد إلكتروني** للبريد الرئيسي في إعدادات الشركة

### محتوى الإشعار:

-   **العنوان**: مثل "رسالة جديدة من أحمد"
-   **الوصف**: ملخص قصير للمحتوى
-   **أيقونة**: أيقونة مناسبة لنوع الإشعار
-   **لون**: لون مميز (info, success, warning, danger)
-   **رابط**: رابط مباشر لعرض التفاصيل في الداشبورد

### محتوى البريد الإلكتروني:

-   موضوع واضح
-   تفاصيل كاملة عن الرسالة/الطلب
-   زر للانتقال للداشبورد

## إعداد البريد الإلكتروني

لتفعيل إرسال البريد الإلكتروني، قم بتحديث ملف `.env`:

```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=your-email@gmail.com
MAIL_FROM_NAME="${APP_NAME}"
```

## استخدام Queue (اختياري)

الإشعارات تعمل في الخلفية (Queued) لتحسين الأداء.

لتشغيل Queue Worker:

```bash
php artisan queue:work
```

أو استخدم Supervisor في الإنتاج.

## عرض الإشعارات في الداشبورد

1. افتح `/admin`
2. ستجد جرس الإشعارات في الزاوية العلوية
3. اضغط عليه لعرض الإشعارات
4. اضغط على أي إشعار للانتقال للتفاصيل
5. يمكنك وضع علامة "مقروء" على الإشعارات

## تخصيص الإشعارات

### تغيير محتوى البريد الإلكتروني:

عدّل ملفات Notification في:

```
app/Notifications/
├── NewContactMessage.php
├── NewDesignRequest.php
├── NewTestimonial.php
└── NewJobApplication.php
```

### تغيير تردد التحديث:

في `AdminPanelProvider.php`:

```php
->databaseNotificationsPolling('30s') // غيّر إلى '60s' أو '2m'
```

## الاختبار

لاختبار النظام:

1. أرسل رسالة من نموذج الاتصال
2. تحقق من جرس الإشعارات في الداشبورد
3. تحقق من البريد الإلكتروني

## ملاحظات

-   تأكد من تشغيل Queue Worker في الإنتاج
-   تأكد من إعدادات البريد الإلكتروني صحيحة
-   البريد الرئيسي يُؤخذ من جدول `company_settings`
